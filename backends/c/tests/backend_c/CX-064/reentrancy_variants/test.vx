// @rfc: docs/vexel-rfc.md#annotations
// @desc: Reentrancy variants are emitted when entry points require different contexts | Reentrancy variants emitted for mixed entry contexts
// @expect-exit: 0
// @command: python3 -c "import pathlib, re, subprocess, sys; subprocess.run([sys.argv[1], '-b', 'c', 'test.vx'], check=True); src = pathlib.Path('out.c').read_text(); ok = re.search(r'\\bvx_helper__reent\\b', src) and re.search(r'\\bvx_helper__nonreent\\b', src); ok = ok and re.search(r'// VEXEL: [^\\n]*reentrant=yes[^\\n]*\\n[^\\n]*vx_helper__reent', src) and re.search(r'// VEXEL: [^\\n]*reentrant=no[^\\n]*\\n[^\\n]*vx_helper__nonreent', src); sys.exit(0 if ok else 1)" {VEXEL} -b c

&^entry_reent() -> #i32 {
    helper(1)
}

[[nonreentrant]] &^entry_nonreent() -> #i32 {
    helper(2)
}

g:#i32 = 0;

&helper(x:#i32) -> #i32 {
    g = g + x;
    g
}
