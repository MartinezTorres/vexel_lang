#!/usr/bin/env bash
set -euo pipefail

ROOT="$(git rev-parse --show-toplevel)"
cd "$ROOT"

echo "==> Building (make)"
make

echo "==> Building web playground (make web)"
make web

if git status --porcelain -- web/playground.html | grep -q .; then
  echo "==> Web playground out of date (web/playground.html)" >&2
  echo "    Run: make web && git add web/playground.html" >&2
  exit 1
fi

echo "==> Running tests (make test)"
make test
